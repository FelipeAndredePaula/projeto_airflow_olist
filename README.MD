# ğŸ“¦ Olist: LogÃ­stica e RetenÃ§Ã£o de Clientes

## ğŸš© O Problema: "A Crise de RetenÃ§Ã£o e o Gargalo LogÃ­stico"
A diretoria da Olist notou que, apesar do alto volume de vendas, a taxa de recompra estÃ¡ caindo. O time de Customer Experience (CX) suspeita que o culpado nÃ£o Ã© o preÃ§o, mas a experiÃªncia de entrega e a performance dos vendedores.

### â“ Pergunta de NegÃ³cio:
> "Quais categorias de produtos, regiÃµes do Brasil e vendedores apresentam os maiores atrasos na entrega? Qual a porcentagem dos pedidos atrasados em relaÃ§Ã£o ao total?"

### ğŸ“Š KPIs de NegÃ³cio
Este projeto entrega a infraestrutura de dados necessÃ¡ria para responder o problema de negÃ³cio descrito acima. Sendo possÃ­vel obter, por exemplo, os seguintes KPI's:

* **SLA (Service Level Agreement):** % de pedidos entregues no prazo.
* **Average Delay:** MÃ©dia de dias de atraso por categoria/vendedor.
* **Top Offenders:** Ranking de vendedores com maior volume de atrasos.

## ğŸ—ï¸ Arquitetura do Pipeline (Medallion Architecture)

O projeto foi estruturado seguindo o padrÃ£o Medallion Architecture para garantir a qualidade e governanÃ§a dos dados.

### ğŸ¥‰ Camada Bronze (Raw Data)
* **Objetivo:** IngestÃ£o bruta dos dados do Kaggle para o Postgres via PostgresOperator, garantindo a persistÃªncia do histÃ³rico sem transformaÃ§Ãµes (Raw Data). Consulte o cÃ³digo para mais detalhes.
* **Processo:** `olist_bronze_dag.py`

### ğŸ¥ˆ Camada Silver (Cleaned Data)
* **Objetivo:** Limpeza, tipagem e deduplicaÃ§Ã£o de dados. AplicaÃ§Ã£o de regras de negÃ³cio iniciais, como cÃ¡lculo de atraso de entrega e padronizaÃ§Ã£o de localizaÃ§Ã£o de vendedores. Consulte o cÃ³digo para mais detalhes.
* **Processo:** `olist_silver_dag.py`
### ğŸ¥‡ Camada Gold (Business Data - Star Schema)
* **Objetivo:** Modelagem dimensional dos dados logÃ­sticos em uma tabela fato e trÃªs dimensÃµes de detalhamentos prontos para consumo em relatÃ³rios e cÃ¡lculos dos KPI's.
* **Processo:** `olist_gold_dag.py`
* **Modelagem:**    
     * **`gold.orders_fact`**: Tabela fato com ID's e mÃ©tricas de tempo e custo de frete.
    * **`gold.dim_sellers`**: DimensÃ£o de detalhamento geogrÃ¡fico dos vendedores.
    * **`gold.dim_products`**: DimensÃ£o de detalhamento das categorias e o volume de produtos.
    * **`gold.dim_calendar`**: DimensÃ£o de datas para anÃ¡lises temporais.

## ğŸ› ï¸ Environment Setup (Passo a Passo)

### 1. Fonte de Dados
**Dataset:** [Brazilian E-Commerce Public Dataset by Olist](https://www.kaggle.com/datasets/olistbr/brazilian-ecommerce) (VersÃ£o 2, 2021/10/01)

### 2. Estrutura inicial da pasta do projeto 
Vale notar que ao instalar o Astro para gerenciar nosso ambiente Apache Airflow novas pastas e arquivos serÃ£o criados para alÃ©m dos descritos abaixo:


    .
    â”œâ”€â”€ dags/
    â”‚   â”œâ”€â”€ (.py contendo as DAGS)
    â”œâ”€â”€ include/
    â”‚   â””â”€â”€ data/ 
            â””â”€â”€ (CSVs)
    â”œâ”€â”€ requirements.txt
    â””â”€â”€ README.md

### 3. Infraestrutura e OrquestraÃ§Ã£o
* **Astro CLI (3.1.6+astro.1):** Gerenciamento do Apache Airflow via Docker.
* **PostgreSQL:** Banco de dados para as camadas Bronze, Silver e Gold.

**ConfiguraÃ§Ãµes Importantes:**
* **requirements.txt:** AdiÃ§Ã£o da linha 

    `apache-airflow-providers-postgres`

    para adicionar o provider Postgres em nosso ambiente Apache Airflow.
* **.env:** AdiÃ§Ã£o da linha  
    
    `AIRFLOW_CONN_POSTGRES_DEFAULT`
    
    para criar a configuraÃ§Ã£o padrÃ£o com o banco de dados Postgres.

## Como Executar
1. [Instale o Astro CLI.](https://www.astronomer.io/docs/astro/cli/install-cli)
2. Clone o repositÃ³rio.
3. Rode `astro dev start` em um terminal dentro do projeto.
4. Acesse o Airflow UI, habilite e rode as DAGs nesta sequÃªncia: 

    `olist_ingestion_bronze` `olist_clean_up_silver` `olist_gold_star_schema`